{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Identificação do Eleitor</title>
    <link rel="stylesheet" href="{% static 'urna/login.css' %}">
</head>
<body>

<div class="container">
    <div class="left-panel">
        <div class="keypad">
            <button class="key">1</button>
            <button class="key">2</button>
            <button class="key">3</button>
            <button class="key">4</button>
            <button class="key">5</button>
            <button class="key">6</button>
            <button class="key">7</button>
            <button class="key">8</button>
            <button class="key">9</button>
            <button class="key" id="clear">Limpar</button>
            <button class="key">0</button>
            <button class="key" id="enter" type="submit" form="loginForm">Entra</button>
        </div>
    </div>

    <div class="right-panel">
        <form method="POST" id="loginForm">
            {% csrf_token %}
            <h2>Identifique-se</h2>

            {% if messages %}
                {% for message in messages %}
                    <p class="error-message">{{ message }}</p>
                {% endfor %}
            {% endif %}
            
            {% if form.non_field_errors %}
                 <p class="error-message">{{ form.non_field_errors.as_text }}</p>
            {% endif %}

            <label for="id_cpf">CPF:</label>
            {{ form.cpf }}
            <div class="error-message">{{ form.cpf.errors }}</div>

            <label for="id_re">Registro (RE):</label>
            {{ form.re }}
            <div class="error-message">{{ form.re.errors }}</div>

            <button type="submit" class="btn-login">Entrar</button>
        </form>
    </div>
</div>

<script>
    // Seleciona os inputs que o Django renderizou (eles têm 'id_')
    const cpfInput = document.getElementById("id_cpf");
    const reInput = document.getElementById("id_re");
    let currentInput = cpfInput;

    function updateFocus() {
        if (currentInput === cpfInput) {
            cpfInput.style.border = '2px solid #0099ff';
            reInput.style.border = '1px solid #ccc';
        } else {
            reInput.style.border = '2px solid #0099ff';
            cpfInput.style.border = '1px solid #ccc';
        }
    }
    updateFocus();

    cpfInput.addEventListener('click', () => {
        currentInput = cpfInput;
        updateFocus();
    });
    reInput.addEventListener('click', () => {
        currentInput = reInput;
        updateFocus();
    });

    // Lógica do teclado numérico
    document.querySelectorAll(".keypad .key").forEach(btn => {
        btn.addEventListener("click", () => {
            if (btn.id === 'clear') {
                currentInput.value = '';
                return;
            }
            if (btn.id === 'enter') {
                return; // O botão já submete o form
            }
            
            // Adiciona o número ao campo de input atual
            currentInput.value += btn.textContent;
            
            // Dispara o evento 'input' para que o formatador de CPF seja acionado
            currentInput.dispatchEvent(new Event('input'));
        });
    });

    // ✨ SCRIPT PARA FORMATAÇÃO AUTOMÁTICA DO CPF ✨
    cpfInput.addEventListener('input', () => {
        // Remove tudo que não for número
        let value = cpfInput.value.replace(/\D/g, '');

        // Limita a 11 dígitos
        value = value.substring(0, 11);

        // Aplica a máscara de formatação
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');

        // Atualiza o valor do campo
        cpfInput.value = value;
    });
</script>

</body>
</html>